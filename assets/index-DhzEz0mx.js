const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DPv42Mmd.js","assets/index-Bp3qVQ4S.js","assets/parseSignature-B_uEEoRC.js","assets/localBatchGatewayRequest-DNDnRYS6.js","assets/hashTypedData-DuQQrqMK.js","assets/index-D_1Qwiay.js","assets/index-kzlEvkEN.js","assets/index-CmlS2zfy.js"])))=>i.map(i=>d[i]);
import{d2 as C,bo as g,aV as D,d3 as m,b$ as b,b1 as A,d4 as I,d5 as _,cm as L}from"./index-Bp3qVQ4S.js";import{d6 as R}from"./index-Bp3qVQ4S.js";function k(f={}){let h,a,o,r;return C(n=>({id:"baseAccount",name:"Base Account",rdns:"app.base.account",type:"baseAccount",async connect({chainId:t,withCapabilities:e,...c}={}){var s;try{const i=await this.getProvider(),w=t??((s=n.chains[0])==null?void 0:s.id);if(!w)throw new m;let{accounts:v,currentChainId:l}=await(async()=>{if(c.isReconnecting)return{accounts:(await i.request({method:"eth_accounts",params:[]})).map(u=>({address:g(u)})),currentChainId:await this.getChainId()};const d=await i.request({method:"wallet_connect",params:[{capabilities:"capabilities"in c&&c.capabilities?c.capabilities:{},chainIds:[b(w),...n.chains.filter(u=>u.id!==w).map(u=>b(u.id))]}]});return{accounts:(await i.request({method:"eth_accounts"})).map(u=>d.accounts.find(q=>q.address===u)??{address:u}).map(u=>({address:g(u.address),capabilities:u.capabilities??{}})),currentChainId:Number(d.chainIds[0])}})();if(a||(a=this.onAccountsChanged.bind(this),i.on("accountsChanged",a)),o||(o=this.onChainChanged.bind(this),i.on("chainChanged",o)),r||(r=this.onDisconnect.bind(this),i.on("disconnect",r)),t&&l!==t){const d=await this.switchChain({chainId:t}).catch(p=>{if(p.code===A.code)throw p;return{id:l}});l=(d==null?void 0:d.id)??l}return{accounts:e?v:v.map(d=>d.address),chainId:l}}catch(i){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(i.message)?new A(i):i}},async disconnect(){const t=await this.getProvider();a&&(t.removeListener("accountsChanged",a),a=void 0),o&&(t.removeListener("chainChanged",o),o=void 0),r&&(t.removeListener("disconnect",r),r=void 0),t.disconnect()},async getAccounts(){return(await(await this.getProvider()).request({method:"eth_accounts"})).map(e=>g(e))},async getChainId(){const e=await(await this.getProvider()).request({method:"eth_chainId"});return Number(e)},async getProvider(){if(!h){const t=(()=>{var s;return typeof f.preference=="string"?{options:f.preference}:{...f.preference,options:((s=f.preference)==null?void 0:s.options)??"all"}})(),{createBaseAccountSDK:e}=await I(async()=>{const{createBaseAccountSDK:s}=await import("./index-DPv42Mmd.js");return{createBaseAccountSDK:s}},__vite__mapDeps([0,1,2,3,4]));h=e({...f,appChainIds:n.chains.map(s=>s.id),preference:t}).getProvider()}return h},async isAuthorized(){try{return!!(await this.getAccounts()).length}catch{return!1}},async switchChain({addEthereumChainParameter:t,chainId:e}){var i,w,v,l;const c=n.chains.find(d=>d.id===e);if(!c)throw new D(new m);const s=await this.getProvider();try{return await s.request({method:"wallet_switchEthereumChain",params:[{chainId:b(c.id)}]}),c}catch(d){if(d.code===4902)try{let p;t!=null&&t.blockExplorerUrls?p=t.blockExplorerUrls:p=(i=c.blockExplorers)!=null&&i.default.url?[(w=c.blockExplorers)==null?void 0:w.default.url]:[];let y;(v=t==null?void 0:t.rpcUrls)!=null&&v.length?y=t.rpcUrls:y=[((l=c.rpcUrls.default)==null?void 0:l.http[0])??""];const u={blockExplorerUrls:p,chainId:b(e),chainName:(t==null?void 0:t.chainName)??c.name,iconUrls:t==null?void 0:t.iconUrls,nativeCurrency:(t==null?void 0:t.nativeCurrency)??c.nativeCurrency,rpcUrls:y};return await s.request({method:"wallet_addEthereumChain",params:[u]}),c}catch(p){throw new A(p)}throw new D(d)}},onAccountsChanged(t){t.length===0?this.onDisconnect():n.emitter.emit("change",{accounts:t.map(e=>g(e))})},onChainChanged(t){const e=Number(t);n.emitter.emit("change",{chainId:e})},async onDisconnect(t){n.emitter.emit("disconnect");const e=await this.getProvider();a&&(e.removeListener("accountsChanged",a),a=void 0),o&&(e.removeListener("chainChanged",o),o=void 0),r&&(e.removeListener("disconnect",r),r=void 0)}}))}S.type="safe";function S(f={}){const{shimDisconnect:h=!1}=f;let a,o;return C(r=>({id:"safe",name:"Safe",type:S.type,async connect({withCapabilities:n}={}){var s;const t=await this.getProvider();if(!t)throw new _;const e=await this.getAccounts(),c=await this.getChainId();return o||(o=this.onDisconnect.bind(this),t.on("disconnect",o)),h&&await((s=r.storage)==null?void 0:s.removeItem("safe.disconnected")),{accounts:n?e.map(i=>({address:i,capabilities:{}})):e,chainId:c}},async disconnect(){var t;const n=await this.getProvider();if(!n)throw new _;o&&(n.removeListener("disconnect",o),o=void 0),h&&await((t=r.storage)==null?void 0:t.setItem("safe.disconnected",!0))},async getAccounts(){const n=await this.getProvider();if(!n)throw new _;return(await n.request({method:"eth_accounts"})).map(g)},async getProvider(){if(typeof window<"u"&&(window==null?void 0:window.parent)!==window){if(!a){const{default:t}=await I(async()=>{const{default:i}=await import("./index-D_1Qwiay.js");return{default:i}},__vite__mapDeps([5,6,1,4])),e=new t(f),c=await L(()=>e.safe.getInfo(),{timeout:f.unstable_getInfoTimeout??10});if(!c)throw new Error("Could not load Safe information");const s=await(async()=>{const i=await I(()=>import("./index-CmlS2zfy.js").then(w=>w.i),__vite__mapDeps([7,1,6]));return typeof i.SafeAppProvider!="function"&&typeof i.default.SafeAppProvider=="function"?i.default.SafeAppProvider:i.SafeAppProvider})();a=new s(c,e)}return a}},async getChainId(){const n=await this.getProvider();if(!n)throw new _;return Number(n.chainId)},async isAuthorized(){var n;try{return h&&await((n=r.storage)==null?void 0:n.getItem("safe.disconnected"))?!1:!!(await this.getAccounts()).length}catch{return!1}},onAccountsChanged(){},onChainChanged(){},onDisconnect(){r.emitter.emit("disconnect")}}))}export{k as baseAccount,R as injected,S as safe};
